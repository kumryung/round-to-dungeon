# Project: Round to Dungeon (Web Prototype)

<br>

## 1. 프로젝트 개요
**Round to Dungeon**은 부루마블(보드게임) 형식의 맵 이동과 턴제 RPG 전투, 그리고 파밍/제작 시스템이 결합된 웹 기반 로그라이크 게임입니다. 플레이어는 몬스터와 함정이 도사리는 맵을 돌며 자원을 모으고, 장비를 제작하여 생존하는 것이 목표입니다.

---

## 2. 게임 코어 루프 (Game Core Loop)
1.  **맵 생성**: 레벨에 따른 사각형 타일 맵 생성 (Lv.1 기준 24칸).
2.  **라운드 시작 (스폰 단계)**:
    *   플레이어가 **시작점(Start Tile)**에 있거나 맵에 **최초 진입** 시 3개의 주사위를 굴림.
    *   `Dice 1 (몬스터)`: 나온 수만큼 랜덤 타일에 몬스터 스폰 (중복 시 레벨업/강화).
    *   `Dice 2 (보물)`: 나온 수만큼 빈 타일에 보물상자 스폰 (웨이브 종료 시 삭제).
    *   `Dice 3 (이벤트)`: 나온 수만큼 빈 타일에 이벤트 스폰.
3.  **이동 단계**:
    *   플레이어가 이동 주사위를 굴림.
    *   해당 수만큼 전진. **단, 남은 이동 횟수가 많아도 '시작점'에서는 무조건 멈춤.**
4.  **액션 단계**: 도착한 타일의 속성에 따라 상호작용.
    *   `Monster`: 턴제 전투 돌입.
    *   `Chest`: 랜덤 아이템 획득.
    *   `Event`: 고정/랜덤 이벤트 발생 (회복, 버프, 디버프 등).
5.  **웨이브(Wave) 시스템**:
    *   플레이어가 맵을 한 바퀴 돌아 시작점에 도착/통과하면 **웨이브 +1**.
    *   웨이브 증가 시: 기존 맵의 몬스터 레벨업(+HP 회복), 새로운 오브젝트 배치 시 타일 셔플.

---

## 3. 핵심 시스템 명세 (System Specifications)

### 3.1. 맵 시스템 (Map)
*   **구조**: 사각형 루프 형태 (부루마블 스타일).
*   **크기**: Lv.N = 한 변 `(5 + N)` 칸. (Ex: Lv.1 = 6칸 x 4변 = 총 24타일)
*   **특수 타일**:
    *   `Index 0` (시작점): 라운드 재정비, 스폰 주사위 굴림.
    *   모서리 3곳: 고정 이벤트 타일.

### 3.2. 전투 시스템 (Combat Logic)
*   **형식**: 1:1 턴제 전투.
*   **선공 결정**: `Speed` 스탯 비교 (높은 쪽 선공).
*   **부위별 타격 시스템 (Hit Location)**:
    *   플레이어는 공격 시 **[머리]**, **[몸]**, **[다리]** 중 하나를 선택.
    *   **몬스터 타입별 타격 가능 부위**:
        *   `일반형`: 전체 타격 가능.
        *   `비행형`: 다리 타격 불가 (버튼 비활성화).
        *   `특수형(슬라임 등)`: 몸통만 타격 가능.
*   **명중/데미지 공식**:
    *   `최종 명중률` = `(Player.DEX * 2) + (부위별 보정치) - (Monster.Evasion)` (Clamp: 5% ~ 95%)
    *   `최종 데미지` = `(Player.Atk - Monster.Def) * (부위별 데미지 배율)`
*   **부위별 설정값**:
    *   `Head`: 명중 보정 -20% / 데미지 1.5배
    *   `Body`: 명중 보정 +10% / 데미지 1.0배
    *   `Legs`: 명중 보정 0% / 데미지 1.0배 (적중 시 디버프 가능성)

### 3.3. 캐릭터 및 스탯 (Character)
*   **직업**:
    *   **워리어**: HP 120 / STR 10 / AGI 3 (무게 보너스)
    *   **도적**: HP 80 / STR 3 / AGI 10 (회피/명중 특화)
    *   **용병**: HP 100 / STR 6 / SPD 10 (선공/연타 특화)
*   **스탯 상세**:
    *   `STR`: 인벤토리 무게, 힘 무기 공격력.
    *   `AGI`: 회피율, 민첩 무기 공격력.
    *   `SPD`: 선공권, 추가 공격 확률.
    *   `DEX`: 명중률 (1당 2%).
    *   `LUK`: 드랍률.

### 3.4. 아이템 및 인벤토리
*   **구조**: 12칸(일반) + 2칸(안전 가방).
*   **제작(Crafting)**: 하위 재료를 조합하여 상위 장비 제작 (판타지 컨셉 리파인 적용).
    *   *Example*: `마나석(Battery)` + `마수의 힘줄(Cable)` + `강철 부품(Gear)` -> 상위 무기.

### 3.5. 정신력 시스템 (Sanity System)
*   **개요**: 던전의 공포와 어둠으로 인해 캐릭터의 정신이 붕괴되는 수치. (Max: 100)
*   **감소 규칙**:
    *   **턴 경과**: 이동 주사위를 굴릴 때마다 **-2** 감소.
    *   **특정 몬스터**: 유령, 악마 등 공포 유발 몬스터 조우 시 **-5** 추가 감소.
    *   **환경**: 함정이나 어두운 타일 진입 시 감소.
*   **디버프 단계 (Thresholds)**:
    *   `70 ~ 100` (평정): 페널티 없음.
    *   `31 ~ 69` (불안): **명중률(Hit Chance) -10%**.
    *   `11 ~ 30` (공포): **명중률 -20%**, **회피율 -10%**.
    *   `0 ~ 10` (광기): **제어 불가** (플레이어 명령 무시, 랜덤 행동).
*   **회복 수단**:
    *   아이템: 성수(Sanity +30), 엘릭서(Full), 횃불(감소 방지).
    *   이벤트: 성소(Shrine) 방문, 캠프파이어 휴식.

### 3.6. 장비 내구도 (Equipment Durability)
*   **개요**: 무기를 사용할수록 날이 무뎌져 성능이 저하됨.
*   **감소 규칙**:
    *   **공격 시**: 몬스터를 타격할 때마다 내구도 **-1** 감소.
*   **파괴 패널티**:
    *   내구도가 **0**이 되면 **[파손]** 상태가 됨.
    *   파손된 무기는 **공격력이 0**으로 고정되거나, 기본 주먹 데미지만 적용됨.
*   **수리**:
    *   대장장이 이벤트 또는 '숫돌(Whetstone)' 등의 아이템 사용(추후 구현).

---

## 4. 데이터 구조 (JSON Schemas)

### 4.1. Monster Data Example
```json
[
  {
    "id": "goblin_01",
    "name": "Goblin",
    "level": 1,
    "stats": { "hp": 35, "atk": 8, "speed": 5, "evasion": 5 },
    "parts": {
      "head": { "active": true, "hit_bonus": -20, "dmg_mult": 1.5 },
      "body": { "active": true, "hit_bonus": 10, "dmg_mult": 1.0 },
      "legs": { "active": true, "hit_bonus": 0, "dmg_mult": 1.0 }
    }
  },
  {
    "id": "bat_01",
    "name": "Bat",
    "type": "Flying",
    "stats": { "hp": 25, "atk": 6, "speed": 12, "evasion": 25 },
    "parts": {
      "head": { "active": true, "hit_bonus": -30, "dmg_mult": 1.5 },
      "body": { "active": true, "hit_bonus": 10, "dmg_mult": 1.0 },
      "legs": { "active": false, "hit_bonus": 0, "dmg_mult": 0 }
    }
  }
]
```

### 4.2. Item/Recipe Data Example (Fantasy Refined)
```json
[
  {
    "id": "mat_battery",
    "name": "마나석",
    "type": "material",
    "desc": "마법적인 힘을 공급하는 희귀 광석 (구 Battery)"
  },
  {
    "id": "w_chainsword",
    "name": "용살자의 대검",
    "type": "weapon",
    "stats": { "min_dmg": 44, "max_dmg": 52 },
    "req_stats": { "str": 21, "dex": 12, "spd": 16 },
    "recipe": [
      { "item_id": "w_saw_blade", "count": 1 },
      { "item_id": "mat_mana_stone", "count": 1 },
      { "item_id": "mat_beast_tendon", "count": 2 }
    ]
  }
]
```

---

### 5. UI/UX 상세 요구사항 (Detailed UI Specifications)

웹 프로토타입은 **[좌측: 정보 패널]**, **[중앙: 게임 보드]**, **[우측/하단: 로그 및 액션]**의 3단 레이아웃을 권장합니다.

#### 5.1. 메인 게임 보드 (Central Board)
*   **타일 렌더링 (Tile Rendering)**:
    *   맵 레벨에 따라 타일 개수가 변하므로(24~60개), 반응형 **Grid** 또는 **Canvas**로 구현.
    *   **특수 타일 표시**:
        *   `Index 0 (Start)`: **[H]**(Home) 또는 깃발 아이콘으로 강조. "웨이브 종료/시작" 지점임을 명시.
        *   `Corner Tiles`: 다른 색상으로 구분 (이벤트 발생 지역).
*   **오브젝트 오버레이**:
    *   플레이어 위치: 캐릭터 아바타(말) 표시.
    *   타일 위 오브젝트: 몬스터(💀), 보물상자(📦), 이벤트(❓) 아이콘을 타일 위에 겹쳐서 표시.
*   **시각 효과 (VFX)**:
    *   **정신력 낮은 상태**: 화면 테두리에 붉은/보라색 비네팅(Vignette) 효과 또는 화면 흔들림 효과 추가.
    *   **어두운 맵**: 플레이어 주변 타일만 밝히고 나머지는 어둡게 처리(Fog of War, 횃불 사용 시 해제).

#### 5.2. 플레이어 HUD (Heads-Up Display)
*   **상태 바 (Status Bars)**:
    *   **HP (체력)**: 빨간색 바 + `Current/Max` 텍스트 표시.
    *   **Sanity (정신력)**: **[New]** 보라색 바 + 상태 텍스트 표시 (평정/불안/공포/광기).
        *   *예: 25/100 (공포)*
    *   **EXP (경험치)**: 하단 얇은 노란색 바.
*   **장비 슬롯 (Equipment)**:
    *   현재 장착 중인 무기 아이콘 표시.
    *   **내구도 표시**: **[New]** 무기 아이콘 하단에 내구도 게이지 또는 `Durability: 50/100` 텍스트 오버레이. 내구도가 0이 되면 아이콘을 **붉은색 X** 처리.
*   **주요 스탯 요약**:
    *   `STR`, `AGI`, `SPD` 등 핵심 스탯을 작게 표시.

#### 5.3. 컨트롤 및 주사위 패널 (Control Panel)
*   **주사위 UI**:
    *   **이동 주사위**: 플레이어가 누를 수 있는 큰 버튼 (`ROLL MOVE`).
    *   **스폰 주사위**: 라운드 시작 시 자동으로 굴러가는 3개의 작은 주사위 애니메이션 (몬스터/보물/이벤트).
*   **턴 정보**:
    *   `Wave: 1` | `Turn: 5` 표시.

#### 5.4. 전투 모달 (Combat Modal)
전투 발생 시 메인 화면 위에 팝업(Overlay)됩니다.

*   **상단: 몬스터 정보**:
    *   몬스터 이름, 이미지, **HP 게이지**.
    *   특이사항 아이콘 (예: 비행형✈️, 슬라임💧).
*   **중앙: 플레이어 액션 (부위 선택)**:
    *   3개의 큰 버튼으로 구성: **[머리]**, **[몸통]**, **[다리]**.
    *   **버튼 상태**:
        *   `Active`: 클릭 가능.
        *   `Disabled`: 몬스터 타입에 따라 비활성화 (예: 박쥐 - 다리 버튼 회색 처리).
    *   **정보 오버레이 (Tooltip/Label)**:
        *   각 버튼 위에 **적중률(Hit Chance)** 실시간 표시 (예: "35%", "85%").
        *   *정신력 페널티가 적용된 최종 확률이어야 함.*
*   **하단: 전투 로그 및 결과**:
    *   "고블린의 머리를 가격! (치명타) -45 데미지."
    *   "무기 내구도 감소 (-1)."
    *   **[도망가기]** 버튼 (성공 확률 표시).

#### 5.5. 인벤토리 및 제작 UI (Inventory & Crafting)
*   **인벤토리 (Grid)**:
    *   **일반 슬롯 (12칸)**: 기본 배경색.
    *   **안전 가방 (2칸)**: 자물쇠 아이콘이나 금색 테두리로 구분 (사망 시 보존됨을 암시).
    *   **무게 게이지**: 하단에 `Current / Max Weight` 바 표시.
    *   **아이템 상호작용**: 클릭 시 팝업 메뉴 (장착, 사용, 버리기).
*   **제작 (Crafting List)**:
    *   좌측: 제작 가능한 레시피 목록.
    *   우측: 선택한 레시피의 필요 재료 (`보유량/필요량`) 표시.
    *   **제작 가능 알림**: 재료가 모두 모인 아이템은 목록에서 **Highlight** 처리.

#### 5.6. 알림 및 피드백 (Toast & Feedback)
*   **아이템 획득**: 화면 중앙 하단에 "+ 철광석 2개 획득" 토스트 메시지.
*   **정신력 경고**: 정신력이 단계(불안/공포)를 넘어갈 때 화면 중앙에 붉은 텍스트로 경고 ("손이 떨리기 시작합니다...").
*   **데미지 폰트 (Floating Text)**: 전투 시 캐릭터/몬스터 위에 데미지 숫자 팝업.

---

## 6. 개발 단계 (Milestones)

1.  **Phase 1 (Movement)**: 맵 생성, 주사위 굴리기, 플레이어 이동 로직 구현.
2.  **Phase 2 (Combat)**: 몬스터 조우 시 전투 화면 전환, 부위별 타격 공식 적용, 승리/패배 처리.
3.  **Phase 3 (Loop)**: 아이템 획득, 인벤토리 구현, 웨이브 증가 및 몬스터 강화 로직.
4.  **Phase 4 (Content)**: 전체 아이템/몬스터 DB 적용, 제작 시스템 구현.


---

