# Project: Round to Dungeon (Web Prototype)

<br>

## 1. 프로젝트 개요
**Round to Dungeon**은 부루마블(보드게임) 형식의 맵 이동과 턴제 RPG 전투, 그리고 파밍/제작 시스템이 결합된 웹 기반 로그라이크 게임입니다. 플레이어는 몬스터와 함정이 도사리는 맵을 돌며 자원을 모으고, 장비를 제작하여 생존하는 것이 목표입니다.

### 기술 스택
- **번들러**: Vite
- **언어**: Vanilla JavaScript (ES Modules)
- **스타일**: Vanilla CSS
- **배포**: 정적 빌드 (`npx vite build`)

### 실행 방법
```bash
npm install
npm run dev       # 개발 서버 (http://localhost:5173)
npx vite build    # 프로덕션 빌드
```

---

## 2. 게임 코어 루프 (Game Core Loop)
1.  **맵 생성**: 레벨에 따른 사각형 타일 맵 생성 (Lv.1 기준 24칸).
2.  **라운드 시작 (스폰 단계)**:
    *   플레이어가 **시작점(Start Tile)**에 있거나 맵에 **최초 진입** 시 3개의 주사위를 굴림.
    *   `Dice 1 (몬스터)`: 나온 수만큼 랜덤 타일에 몬스터 스폰 (중복 시 레벨업/강화).
    *   `Dice 2 (보물)`: 나온 수만큼 빈 타일에 보물상자 스폰 (웨이브 종료 시 삭제).
    *   `Dice 3 (이벤트)`: 나온 수만큼 빈 타일에 이벤트 스폰.
3.  **이동 단계**:
    *   플레이어가 이동 주사위를 굴림.
    *   해당 수만큼 전진. **단, 남은 이동 횟수가 많아도 '시작점'에서는 무조건 멈춤.**
    *   이동 시 타일당 HP 소량 회복 (`settings.js: hpRegenPerTile`).
    *   정신력(Sanity) 감소 (횃불 버프 시 방지).
4.  **액션 단계**: 도착한 타일의 속성에 따라 상호작용.
    *   `Monster`: 턴제 전투 돌입.
    *   `Chest`: 랜덤 아이템 획득.
    *   `Event`: 맵별 이벤트 풀에서 랜덤 발생 (회복, 버프, 디버프 등).
5.  **웨이브(Wave) 시스템**:
    *   플레이어가 맵을 한 바퀴 돌아 시작점에 도착/통과하면 **웨이브 +1**.
    *   웨이브 증가 시: 기존 맵의 몬스터 레벨업(+HP 회복), 새로운 오브젝트 배치 시 타일 셔플.

---

## 3. 핵심 시스템 명세 (System Specifications)

### 3.1. 맵 시스템 (Map)
*   **구조**: 사각형 루프 형태 (부루마블 스타일).
*   **크기**: 한 변 `(baseMapSize + mapLv)` 칸 × 4변. (Ex: Lv.1 = 6칸 × 4변 = 총 24타일)
*   **맵 종류** (4종):
    | 맵 | 테마 | 몬스터 풀 | 특징 |
    |---|---|---|---|
    | 🌲 고블린 숲 | forest | 고블린, 박쥐, 슬라임 | 초보자 친화, 치유 이벤트 많음 |
    | ⛏️ 버려진 광산 | mine | 오크, 해골, 고블린 킹 | 중급, 함정 증가 |
    | 👻 유령의 늪 | swamp | 유령, 독슬라임, 미믹 | 정신력 소모, 어둠 이벤트 |
    | 🏰 암흑 성채 | citadel | 암흑 기사, 발로그, 악마 | 최고 난이도, 고위험 |
*   **특수 타일**:
    *   `Index 0` (시작점): 라운드 재정비, 스폰 주사위 굴림.
    *   모서리 3곳: 고정 이벤트 타일.
*   **맵별 시각 테마**: 타일 색상이 맵 테마에 따라 변경 (녹/갈/보라/붉은).

### 3.2. 전투 시스템 (Combat Logic)
*   **형식**: 1:1 턴제 전투.
*   **선공 결정**: `Speed` 스탯 비교 (높은 쪽 선공).
*   **부위별 타격 시스템 (Hit Location)**:
    *   플레이어는 공격 시 **[머리]**, **[몸]**, **[다리]** 중 하나를 선택.
    *   **몬스터 타입별 타격 가능 부위**:
        *   `일반형`: 전체 타격 가능.
        *   `비행형`: 다리 타격 불가 (버튼 비활성화).
        *   `특수형(슬라임 등)`: 몸통만 타격 가능.
*   **명중/데미지 공식**:
    *   `최종 명중률` = `부위별 기본명중률(50/100/75) + (Player.DEX × 2) - (Monster.Evasion)` (Clamp: 5% ~ 95%)
    *   `최종 데미지` = `(Player.Atk - Monster.Def) × (부위별 데미지 배율)`
    *   정신력 디버프에 따라 명중률/회피율 추가 보정.
*   **부위별 설정값**:
    *   `Head`: 기본 명중 50% / 데미지 1.5배
    *   `Body`: 기본 명중 100% / 데미지 1.0배
    *   `Legs`: 기본 명중 75% / 데미지 1.0배
*   **몬스터 고유 능력** (16종):
    *   소환 (`m_summoner`), 물리 반감 (`m_ghost`), 광역 공격 (`m_balrog`)
    *   화상 디버프 (`m_demon`), 중독 (`m_poison_slime`), 기습 치명타 (`m_mimic`)
    *   속박 (`m_treant`), 버프 (`m_goblin_king`), 재생 (`m_giant_slime`) 등
*   **레벨 스케일링**: `Base × (1 + (Wave−1) × GrowthRate)` — 웨이브마다 몬스터 성장.

### 3.3. 캐릭터 및 스탯 (Character)
*   **방랑자 5명** (DATASET §6):
    *   각각 고유 스탯 (HP / STR / AGI / SPD / DEX / LUK), 시작 무기, 특성(Trait) 보유.
*   **스탯 상세**:
    *   `STR`: 인벤토리 무게, 힘 무기 공격력.
    *   `AGI`: 회피율, 민첩 무기 공격력.
    *   `SPD`: 선공권, 추가 공격 확률.
    *   `DEX`: 명중률 (1당 2%).
    *   `LUK`: 드랍률.
*   **특성(Trait) 시스템**: 긍정 7종 / 부정 7종 — 전투/이동/인벤토리에 영향.

### 3.4. 아이템 및 인벤토리
*   **구조**: 12칸(일반) + 2칸(안전 가방). 슬롯 수는 `settings.js`에서 관리.
*   **아이템 종류**:
    *   **소모품** (5종): 붕대, 약초, 성수, 엘릭서, 랜턴 오일 등
    *   **도구** (4종): 해독제, 부목, 횃불, 삽/열쇠
    *   **재료** (11종): 철광석, 마나석, 가죽끈 등 — 제작 재료
    *   **무기** (17종 + 주먹): 일반(5) / 영웅(6) / 전설(5) 등급
*   **제작(Crafting)**: 재료를 조합하여 상위 무기 제작 (제작 UI: 레시피 카드 + 재료 확인).
*   **안전 가방**: 사망 시 보존, 인벤토리 ↔ 안전 가방 양방향 이동 가능.

### 3.5. 정신력 시스템 (Sanity System)
*   **개요**: 던전의 공포와 어둠으로 인해 캐릭터의 정신이 붕괴되는 수치. (Max: 100)
*   **감소 규칙**:
    *   **턴 경과**: 이동 주사위를 굴릴 때마다 감소 (`settings.js: sanityCostPerMove`).
    *   **환경**: 함정이나 어두운 타일 진입 시 감소.
    *   **횃불 버프**: 활성 시 이동 정신력 감소 방지.
*   **디버프 단계 (Thresholds)**:
    *   `70 ~ 100` (평정): 페널티 없음.
    *   `31 ~ 69` (불안): **명중률(Hit Chance) -10%**.
    *   `11 ~ 30` (공포): **명중률 -20%**, **회피율 -10%**.
    *   `0 ~ 10` (광기): **제어 불가** (플레이어 명령 무시, 랜덤 행동).
*   **회복 수단**:
    *   아이템: 성수(Sanity +30), 엘릭서(Full), 횃불(감소 방지).
    *   이벤트: 성소(Shrine) 방문, 캠프파이어 휴식.

### 3.6. 상태이상 시스템 (Status Effects)
*   **종류**:
    *   🟢 **중독 (poison)**: 매 턴 HP 감소 (독슬라임 30% 확률, 5턴)
    *   🔥 **화상 (burn)**: 매 턴 Sanity 감소 (악마, 3턴)
    *   🔦 **횃불 (torch_buff)**: 이동 시 정신력 감소 방지 (10턴)
    *   💜 **골절 (fracture)**: 민첩 감소 (트렌트 속박)
*   **해제 수단**: 해독제(중독), 부목(골절), 엘릭서(전체), 자연 경과(턴 만료)
*   **HUD 표시**: 아이콘 + 남은 턴 수 배지 (맥동 애니메이션)

### 3.7. 장비 내구도 (Equipment Durability)
*   **감소 규칙**: 공격 시 내구도 **-1**.
*   **파괴 패널티**: 내구도 0 → **[파손]** → 주먹 데미지만 적용.

---

## 4. 프로젝트 구조

```
src/
├── main.js                     # 엔트리 + 씬 등록
├── sceneManager.js             # 씬 전환 관리
├── mapEngine.js                # 사각형 루프 맵 생성·렌더링
├── dungeonState.js             # 던전 런타임 상태 (이동/스폰/상태이상)
├── combatEngine.js             # 턴제 전투 로직
├── combatOverlay.js            # 전투 UI 오버레이
├── inventory.js                # 인벤토리 시스템
├── inventoryOverlay.js         # 인벤토리 UI + 아이템 효과
├── craftingOverlay.js          # 제작 UI
├── data/
│   ├── settings.js             # 게임 수치 설정값
│   ├── monsters.js             # 몬스터 16종 데이터
│   ├── weapons.js              # 무기 17종 + 주먹
│   ├── items.js                # 소모품/도구/재료 + 이벤트 + 드롭 테이블
│   ├── recipes.js              # 제작 레시피 16종
│   ├── maps.js                 # 맵 4종 (이벤트풀 + 테마)
│   └── wanderers.js            # 방랑자 5명
├── scenes/
│   ├── titleScene.js           # 타이틀 화면
│   ├── townScene.js            # 마을 (맵 선택 + 캐릭터 선택)
│   └── dungeonScene.js         # 던전 메인 씬
└── style.css                   # 전체 스타일 (~2580줄)
```

---

## 5. UI/UX 상세 요구사항 (Detailed UI Specifications)

웹 프로토타입은 **[좌측: 정보 패널]**, **[중앙: 게임 보드]**, **[우측/하단: 로그 및 액션]**의 3단 레이아웃입니다.

#### 5.1. 메인 게임 보드 (Central Board)
*   **타일 렌더링**: 반응형 Grid로 구현 (맵 레벨에 따라 24~60개).
*   **오브젝트 오버레이**: 몬스터(💀), 보물상자(📦), 이벤트(❓).
*   **맵별 타일 테마**: forest(녹), mine(갈), swamp(보라), citadel(붉은).
*   **정신력 VFX**: 30 이하 비네팅 + 맥동, 10 이하 화면 흔들림.

#### 5.2. 플레이어 HUD
*   **HP 바** (빨간색), **Sanity 바** (보라색 + 상태 텍스트), **상태이상 배지**.
*   **장비 슬롯**: 무기 아이콘 + 내구도 게이지.
*   **스탯 요약**: STR/AGI/SPD 등.

#### 5.3. 전투 모달
*   부위 선택 (머리/몸통/다리), 적중률 실시간 표시, 전투 로그, 도망 버튼.

#### 5.4. 인벤토리 (인라인 패널)
*   12칸 + 안전가방 2칸, 아이템 클릭 팝업 (장착/사용/이동/버리기).

#### 5.5. 제작 UI
*   레시피 카드 목록, 재료 보유량 표시, 등급별 정렬.

---

## 6. 개발 단계 (Milestones)

| Phase | 이름 | 상태 | 설명 |
|-------|------|------|------|
| 1 | Movement | ✅ 완료 | 맵 생성, 주사위, 플레이어 이동 |
| 2 | Combat | ✅ 완료 | 전투 시스템, 몬스터 AI, 부위별 타격 |
| 3 | Loop | ✅ 완료 | 인벤토리, 장비, 정신력, 이벤트, 웨이브 |
| 4 | Content | ✅ 완료 | 16종 몬스터, 제작, 소모품/상태이상, 맵 4종 |

### 남은 항목
- EXP 시스템 (경험치 바 + 레벨업)
- Fog of War (횃불 연동)
- 반응형 대응 (모바일/태블릿)
- 데미지 플로팅 텍스트
- SEO 기본 태그

---
